import unittest

import asar_text


class TestAsarText(unittest.TestCase):
    def _check_it(self, text, expected):
        expected = list(map(chr, expected))
        calculated = list(map(chr, asar_text.TextMapper.map(text)))
        self.assertListEqual(expected, calculated)

    def test_double_newline_at_end(self):
        self._check_it(
            "Ein magischer Tornado \\n\\n",
            [
                0x45,
                0x69,
                0x6E,
                0x20,
                0x6D,
                0x61,
                0x67,
                0x69,
                0x73,
                0x63,
                0x68,
                0x65,
                0x72,
                0x20,
                0x54,
                0x6F,
                0x72,
                0x6E,
                0x61,
                0x64,
                0x6F,
                0x20,
                0x0D,
                0x0D,
            ],
        )

    def test_lut_across_newlines(self):
        self._check_it(
            "Hey, Du siehst so aus als würdest Du den Krabbenlauf beher-\\nschen. Versuch`s mal.",
            [
                0x48,
                0x65,
                0x79,
                0x2C,
                0x20,
                0x83,
                0x73,
                0x69,
                0x65,
                0x68,
                0x73,
                0x74,
                0x20,
                0xE9,
                0xAD,
                0x0D,
                0xAF,
                0x77,
                0x5B,
                0x72,
                0x64,
                0x65,
                0x73,
                0x74,
                0x20,
                0x83,
                0xB7,
                0x0D,
                0x4B,
                0x72,
                0x61,
                0x62,
                0x62,
                0x65,
                0x6E,
                0x6C,
                0x61,
                0x75,
                0x66,
                0x20,
                0x62,
                0x65,
                0x68,
                0x65,
                0x72,
                0x2D,
                0x0D,
                0x73,
                0x63,
                0x68,
                0x65,
                0x6E,
                0x2E,
                0x20,
                0x56,
                0x65,
                0x72,
                0x73,
                0x75,
                0x63,
                0x68,
                0x60,
                0x73,
                0x20,
                0x6D,
                0x61,
                0x6C,
                0x2E,
            ],
        )

    def test_starting_with_space(self):
        self._check_it(" Nr1:\\n\\n", [0x20, 0x4E, 0x72, 0x31, 0x3A, 0x0D, 0x0D])

    def test_punctuation(self):
        self._check_it(
            "Du weißt nicht wie?Drücke einfach während des Laufens die L- oder R-Taste.",
            [
                0x83,
                0x77,
                0x65,
                0x69,
                0x25,
                0x74,
                0x20,
                0xDF,
                0x77,
                0x69,
                0x65,
                0x3F,
                0x0D,
                0x44,
                0x72,
                0x5B,
                0x63,
                0x6B,
                0x65,
                0x20,
                0x65,
                0x69,
                0x6E,
                0x66,
                0x61,
                0x63,
                0x68,
                0x20,
                0x77,
                0x7B,
                0x68,
                0x72,
                0x65,
                0x6E,
                0x64,
                0x20,
                0x0D,
                0xB8,
                0x4C,
                0x61,
                0x75,
                0x66,
                0x65,
                0x6E,
                0x73,
                0x20,
                0xB5,
                0x4C,
                0x2D,
                0x20,
                0x6F,
                0x64,
                0x65,
                0x72,
                0x20,
                0x0D,
                0x52,
                0x2D,
                0x54,
                0x61,
                0x73,
                0x74,
                0x65,
                0x2E,
            ],
        )
        self._check_it(
            "Na siehst Du ! Ich wußte daß Du es \\nkannst. !",
            [
                0x4E,
                0x61,
                0x20,
                0x73,
                0x69,
                0x65,
                0x68,
                0x73,
                0x74,
                0x20,
                0x83,
                0x21,
                0x20,
                0x8F,
                0x0D,
                0x77,
                0x75,
                0x25,
                0x74,
                0x65,
                0x20,
                0xBA,
                0x83,
                0xC3,
                0x0D,
                0x6B,
                0x61,
                0x6E,
                0x6E,
                0x73,
                0x74,
                0x2E,
                0x20,
                0x21,
            ],
        )


if __name__ == "__main__":
    import nose2

    nose2.discover()
